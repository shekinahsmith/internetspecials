!function($,t,e,o){"use strict";function i(t,e){return $.get("https://maps.googleapis.com/maps/api/geocode/json",{key:t,latlng:e.join(","),result_type:["street_address","postal_code"].join("|")})}function n(t,e){if("undefined"!=typeof hQ)try{hQ.storeOnce(t,e)}catch(o){}}function s(t,e){if("undefined"!=typeof hQ)try{hQ.storeOnce(t,e)}catch(o){}}function a(t,e){if("object"==typeof halcyon)try{$.post("/geo_location_serviceability.php",{address:t,zip:e,hud:halcyon.cookie.getHUD().i,source:"GPS"})}catch(o){}}function r(t,o,i){t&&c(t)&&(e.cookie=t+"="+(o?";path="+o:"")+(i?";domain="+i:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")}function c(t){var o,i,n,s;return o=!1,$.each(e.cookie.split(";"),function(e,a){s=a.split("="),i=$.trim(s[0]),t.toLowerCase()===i.toLowerCase()&&(o=!0,n=s.length>1?unescape($.trim(s[1])):null)}),o?n:!1}function d(t,o,i,n,s,a){var r=new Date;r.setTime(r.getTime()),"undefined"!=typeof t&&("undefined"==typeof o&&(o=""),i="number"==typeof i?new Date(r.getTime()+i):!1,"undefined"==typeof n&&(n="/"),e.cookie=t+"="+escape(o)+(i?";expires="+i.toGMTString():"")+(n?";path="+n:"")+(s?";domain="+s:"")+(a?";secure":""))}var h="geocode",u="rv_geocode",l={cookieName:"rv_geolocated",hailoEventName:"gelocated",googleApiKey:"AIzaSyD4PzTnZen781x0B0tr9Eqzy00iw9ibXRk",keys:{single:"geolocation",formatted:"geolocation-formatted"},positionOptions:{enableHighAccuracy:!1,maximumAge:3e5,timeout:3e3},runServicability:!0,onDone:$.noop,onFail:$.noop,onAlways:$.noop};$.rv=$.rv||{};var p=$.rv[h]=function(t,e){this.element=t,this.options=$.extend(!0,{},l,e),this._defaults=l,this._name=u,this.run=this.runCommand,this.init()};p.prototype={init:function(){var t,e,o,i,n,s;t=this.checkStatus(),$(this.element).length>0&&(t?(o=this.options.onAlways.bind(this),i=this.options.onDone.bind(this),n=this.options.onFail.bind(this),s=this.updateLocation.bind(this),e=$.Deferred(),e.done([s,i]).fail(n).always(o),"status"in t&&"OK"===t.status.toUpperCase()?e.resolveWith(t):e.rejectWith(t)):this.getCurrentPosition())},runCommand:function(t,e){this.hasOwnProperty(t)&&this[t](e)},getCurrentPosition:function(){var t,e,o;o=this.showPosition.bind(this),t=this.handleError.bind(this),e=this.options.positionOptions,navigator.geolocation.getCurrentPosition(o,t,e)},checkStatus:function(t){return t?cached_address?$.parseJSON(address):!1:void 0},showPosition:function(t){var e,o,n,s,a,r,c;return t?(e=[],e.push($.trim(t.coords.latitude)),e.push($.trim(t.coords.longitude)),n=this.options.onAlways.bind(this),s=this.options.onDone.bind(this),a=this.options.onFail.bind(this),r=this.saveStatus.bind(this),c=this.updateLocation.bind(this),void i(this.options.googleApiKey,e).then(r,a).done([c,s]).always(n)):!1},saveStatus:function(t){var e,o,i;return e={},o=$.Deferred(),i=t.results,i.length>0&&($.each(i,function(t,o){!e.formatted_address&&o.formatted_address&&(e.formatted_address=o.formatted_address),$.each(o.address_components,function(t,o){!e.street_number&&$.inArray("street_number",o.types)>-1&&(e.street_number=$.trim(o.short_name)),!e.route&&$.inArray("route",o.types)>-1&&(e.route=$.trim(o.short_name),e.route_long=$.trim(o.long_name)),!e.city&&$.inArray("locality",o.types)>-1&&$.inArray("political",o.types)>-1&&(e.city=$.trim(o.short_name),e.city_long=$.trim(o.long_name)),!e.state&&$.inArray("administrative_area_level_1",o.types)>-1&&$.inArray("political",o.types)>-1&&(e.state=$.trim(o.short_name),e.state_long=$.trim(o.long_name)),!e.postal_code&&$.inArray("postal_code",o.types)>-1&&(e.postal_code=$.trim(o.long_name).substr(0,5))}),e.route&&(e.street_address=$.trim([e.street_number,e.route].join(" ")))}),t.rv_address_data=$.extend(!0,{},e)),d(this.options.cookieName,JSON.stringify(t)),"status"in t&&"OK"===t.status.toUpperCase()&&(n(this.options.hailoEventName,{location:e.formatted_address}),this.options.runServicability&&a(e.formatted_address,e.postal_code),$("body").trigger("locationFound")),o.resolve(t)},handleError:function(t){switch(this.options.onFail.call(this),t.code){case 1:console.warn("User denied the request for Geolocation."),this.saveStatus.call(this,t);break;case 2:console.warn("Location information is unavailable."),r(this.options.cookieName);break;case 3:console.warn("The request to get user location timed out."),r(this.options.cookieName);break;default:console.warn(t.message),r(this.options.cookieName)}},updateLocation:function(t){var e,o;e=t.rv_address_data,o=this.options.keys,e&&$(this.element).find("[data-"+o.single+"]").each(function(t,i){var n=e[$(i).data(o.single)];n&&$(i).text(n)}).end().find("[data-"+o.formatted+"]").each(function(t,i){var n,s,a;n=$(i).data(o.formatted),s=n.match(/\{\{[a-z,A-Z,\d]+\}\}/g),$.isArray(s)&&(a=n+"",$.each(s,function(t,o){var i=$.trim(o.replace("{{","").replace("}}",""));a=e[i]?a.replace(o,e[i]):""}),a&&a.length&&$(i).text(a))})}},$.fn[u]=function(t){return"function"==typeof $&&"geolocation"in navigator?this.each(function(){$.data(this,u)||$.data(this,u,new p(this,t))}):void 0}}(jQuery,window,document);
//# sourceMappingURL=./rv-geocode.min.js.map